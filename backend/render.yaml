# Render Blueprint - Supply Chain Platform
# Deploy all services with: Connect repo â†’ Use Blueprint
# 
# IMPORTANT: After deployment, manually set service URLs in API Gateway environment:
# - INVENTORY_SERVICE_URL = https://inventory-service-xxxx.onrender.com
# - ORDER_SERVICE_URL = https://order-service-xxxx.onrender.com
# - etc.

databases:
  - name: supplychain-db
    plan: free
    databaseName: supplychaindb
    user: supplychainuser
    region: oregon

services:
  # ============================================
  # API GATEWAY - Main Entry Point (Port 3000)
  # ============================================
  - type: web
    name: api-gateway
    plan: free
    runtime: node
    region: oregon
    rootDir: backend/services/1-api-gateway
    buildCommand: npm install
    startCommand: node src/server.js
    healthCheckPath: /health
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 3000
      # IMPORTANT: Set these manually after all services are deployed
      # Use format: https://service-name-xxxx.onrender.com
      - key: INVENTORY_SERVICE_URL
        sync: false
      - key: ORDER_SERVICE_URL
        sync: false
      - key: WAREHOUSE_SERVICE_URL
        sync: false
      - key: DELIVERY_SERVICE_URL
        sync: false
      - key: NOTIFICATION_SERVICE_URL
        sync: false
      - key: FORECASTING_SERVICE_URL
        sync: false
      - key: AGENTIC_AI_SERVICE_URL
        sync: false
      - key: FRONTEND_URL
        sync: false
      - key: FIREBASE_SERVICE_ACCOUNT
        sync: false

  # ============================================
  # INVENTORY SERVICE (Port 3001)
  # ============================================
  - type: web
    name: inventory-service
    plan: free
    runtime: node
    region: oregon
    rootDir: backend/services/2-inventory-service
    buildCommand: npm install --include=dev && npm run build
    startCommand: node dist/main.js
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 3001
      - key: DB_HOST
        fromDatabase:
          name: supplychain-db
          property: host
      - key: DB_PORT
        fromDatabase:
          name: supplychain-db
          property: port
      - key: DB_USERNAME
        fromDatabase:
          name: supplychain-db
          property: user
      - key: DB_PASSWORD
        fromDatabase:
          name: supplychain-db
          property: password
      - key: DB_NAME
        fromDatabase:
          name: supplychain-db
          property: database

  # ============================================
  # ORDER SERVICE (Port 3002)
  # ============================================
  - type: web
    name: order-service
    plan: free
    runtime: node
    region: oregon
    rootDir: backend/services/3-order-service
    buildCommand: npm install --include=dev && npm run build
    startCommand: node dist/main.js
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 3002
      - key: DB_HOST
        fromDatabase:
          name: supplychain-db
          property: host
      - key: DB_PORT
        fromDatabase:
          name: supplychain-db
          property: port
      - key: DB_USERNAME
        fromDatabase:
          name: supplychain-db
          property: user
      - key: DB_PASSWORD
        fromDatabase:
          name: supplychain-db
          property: password
      - key: DB_NAME
        fromDatabase:
          name: supplychain-db
          property: database
      # Set manually: https://inventory-service-xxxx.onrender.com
      - key: INVENTORY_SERVICE_URL
        sync: false

  # ============================================
  # WAREHOUSE SERVICE (Port 3003)
  # ============================================
  - type: web
    name: warehouse-service
    plan: free
    runtime: node
    region: oregon
    rootDir: backend/services/4-warehouse-service
    buildCommand: npm install --include=dev && npm run build
    startCommand: node dist/main.js
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 3003
      - key: DB_HOST
        fromDatabase:
          name: supplychain-db
          property: host
      - key: DB_PORT
        fromDatabase:
          name: supplychain-db
          property: port
      - key: DB_USERNAME
        fromDatabase:
          name: supplychain-db
          property: user
      - key: DB_PASSWORD
        fromDatabase:
          name: supplychain-db
          property: password
      - key: DB_NAME
        fromDatabase:
          name: supplychain-db
          property: database
      # Set manually: https://inventory-service-xxxx.onrender.com
      - key: INVENTORY_SERVICE_URL
        sync: false

  # ============================================
  # DELIVERY SERVICE (Port 3004)
  # ============================================
  - type: web
    name: delivery-service
    plan: free
    runtime: node
    region: oregon
    rootDir: backend/services/5-delivery-service
    buildCommand: npm install --include=dev && npm run build
    startCommand: node dist/main.js
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 3004
      - key: DB_HOST
        fromDatabase:
          name: supplychain-db
          property: host
      - key: DB_PORT
        fromDatabase:
          name: supplychain-db
          property: port
      - key: DB_USERNAME
        fromDatabase:
          name: supplychain-db
          property: user
      - key: DB_PASSWORD
        fromDatabase:
          name: supplychain-db
          property: password
      - key: DB_NAME
        fromDatabase:
          name: supplychain-db
          property: database
      - key: MAPPING_API_KEY
        sync: false

  # ============================================
  # NOTIFICATION SERVICE (Port 3005)
  # ============================================
  - type: web
    name: notification-service
    plan: free
    runtime: node
    region: oregon
    rootDir: backend/services/6-notification-service
    buildCommand: npm install --include=dev && npm run build
    startCommand: node dist/main.js
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 3005
      - key: FIREBASE_SERVICE_ACCOUNT
        sync: false
      - key: SENDGRID_API_KEY
        sync: false
      - key: SENDGRID_FROM_EMAIL
        sync: false
      - key: TWILIO_ACCOUNT_SID
        sync: false
      - key: TWILIO_AUTH_TOKEN
        sync: false
      - key: TWILIO_PHONE_NUMBER
        sync: false

  # ============================================
  # FORECASTING SERVICE - Python (Port 8000)
  # ============================================
  - type: web
    name: forecasting-service
    plan: free
    runtime: python
    region: oregon
    rootDir: backend/services/7-forecasting-service
    buildCommand: pip install -r requirements.txt
    startCommand: uvicorn src.main:app --host 0.0.0.0 --port $PORT
    envVars:
      - key: PORT
        value: 8000
      - key: PYTHON_VERSION
        value: 3.11.0
      - key: DB_HOST
        fromDatabase:
          name: supplychain-db
          property: host
      - key: DB_PORT
        fromDatabase:
          name: supplychain-db
          property: port
      - key: DB_USERNAME
        fromDatabase:
          name: supplychain-db
          property: user
      - key: DB_PASSWORD
        fromDatabase:
          name: supplychain-db
          property: password
      - key: DB_NAME
        fromDatabase:
          name: supplychain-db
          property: database

  # ============================================
  # AGENTIC AI SERVICE - Python (Port 8001)
  # ============================================
  - type: web
    name: agentic-service
    plan: free
    runtime: python
    region: oregon
    rootDir: backend/services/8-agentic-ai-service
    buildCommand: pip install -r requirements.txt
    startCommand: uvicorn src.main:app --host 0.0.0.0 --port $PORT
    envVars:
      - key: PORT
        value: 8001
      - key: PYTHON_VERSION
        value: 3.11.0
      - key: GROQ_API_KEY
        sync: false